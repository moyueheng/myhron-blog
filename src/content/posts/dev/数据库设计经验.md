---
title: 数据库设计全攻略：从基础规范到多租户实战
published: 2026-01-05
description: ""
image: ""
tags: ["dev", "db"]
category: "dev"
draft: false
lang: ""
---

这是一篇为您汇总了**数据库设计原则、扩展字段实战、以及多租户架构经验**的全能型博客笔记。它结合了理论深度与工程实操，非常适合作为团队内部分享或个人技术积累。

---

# 数据库设计全攻略：从基础规范到多租户实战

在系统架构中，数据库设计不仅关系到数据的存取，更决定了业务迭代的效率和系统的伸缩性。本文将从规范化、灵活性以及多租户隔离三个维度，带你系统性地梳理数据库设计的核心逻辑。

---

## 一、 坚实的地基：规范化与标准字段

一个好的设计始于规范。虽然业务千变万化，但底层逻辑应保持一致。

### 1. 三大范式 (Normalization)

* **1NF（原子性）**：字段不可再分。
* **2NF（完全依赖）**：非主键列必须完全依赖于主键。
* **3NF（直接依赖）**：消除传递依赖，减少冗余。

### 2. 强制标配：每张表的“四大金刚”

无论业务大小，建议每张表都包含以下四个字段，以应对审计、追溯和逻辑删除的需求。

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| `id` | `BIGINT` | 主键，推荐使用自增 ID 或分布式雪花 ID。 |
| `create_time` | `DATETIME` | 数据创建时间，严禁手动修改。 |
| `update_time` | `DATETIME` | 数据最后更新时间，通常由数据库自动维护。 |
| `is_deleted` | `TINYINT` | 逻辑删除标识（0:正常, 1:删除），防止误删。 |

---

## 二、 灵活性利器：扩展字段 (`extra_info`)

在快速迭代的环境中，频繁修改表结构（DDL）是高风险操作。此时，引入扩展字段（通常命名为 `extra_info` 或 `metadata`）至关重要。

### 1. 为什么好用？

* **无感迭代**：新增非核心业务字段无需改表，直接写入 JSON 即可。
* **稀疏数据处理**：处理不同类型实体的差异化属性（如衣服的尺寸、电器的电压），避免出现大量 `NULL` 列。
* **兼容性**：完美存储第三方接口返回的原始报文。

### 2. 实战示意 (ASCII Art)

```text
+-----------------------------------------------------------+
|                      Table: Products                      |
+----+-----------+--------+---------------------------------+
| ID |   Name    | Price  |           extra_info            |
+----+-----------+--------+---------------------------------+
| 1  | T-Shirt   | 99.00  | {"size": "L", "color": "Blue"}  |
| 2  | Laptop    | 8999   | {"cpu": "i9", "ram": "32G"}     |
+----+-----------+--------+---------------------------------+

```

> **注意**：需要频繁作为查询条件的字段必须提取出来做**独立索引**，JSON 内部字段通常不建议承担核心搜索功能。

---

## 三、 高阶架构：多租户设计 (Multi-tenancy)

SaaS 系统的核心在于如何隔离不同客户（租户）的数据。

### 1. 三种隔离模式

1. **独立库**：物理隔离最强，安全性最高，但成本高、维护难。
2. **独立 Schema**：逻辑隔离，在同一个库下通过不同的 Schema 区分。
3. **共享表 (Shared Schema)**：通过 `tenant_id` 区分（**最主流**）。

### 2. 多租户实战红线

* **自动化拦截**：必须在框架层面（如 MyBatis 拦截器、PostgreSQL RLS）强制注入 `tenant_id`，杜绝手动写 WHERE 条件。
* **唯一索引陷阱**：原本的唯一索引必须带上 `tenant_id`。
* *错误*：`UNIQUE(phone)`
* *正确*：`UNIQUE(tenant_id, phone)`


* **资源公平**：警惕“噪声邻居”效应，对高频访问的租户进行限流或物理迁移。

---

## 四、 综合设计经验总结 (Mind Map)

```text
数据库设计
├── 基础层 (Standard)
│   ├── 遵循 3NF，适度反规范化
│   ├── 统一命名规范 (snake_case)
│   └── 严禁物理删除，使用 is_deleted
├── 扩展层 (Flexibility)
│   ├── 核心字段独立，非核心放入 extra_info (JSON)
│   ├── 金额使用 DECIMAL 或以 "分" 为单位的 INT
│   └── 索引遵循最左匹配原则
└── 架构层 (Multi-tenancy)
    ├── 强制 tenant_id 过滤
    ├── 唯一索引包含租户标识
    └── 结合 RLS (行级安全) 提升隔离级别

```

---

## 五、 结语

好的数据库设计是在**规范性**（数据准）、**性能**（查得快）与**灵活性**（改得动）之间找到微妙的平衡。先追求 3NF 的严谨，再针对高并发场景进行反规范化和 JSON 扩展，最后通过多租户隔离支撑起商业化运作，这是一名合格架构师的必经之路。

